# Config.json 更新说明

## 需要在 config.json 中添加的新提示词

在 `"prompts"` 部分添加以下内容：

```json
{
  "api_provider": "deepseek",
  "ollama": {
    "base_url": "http://localhost:11434",
    "model": "qwen3-vl:32b"
  },
  "deepseek": {
    "base_url": "https://api.deepseek.com/v1",
    "api_key": "sk-your-api-key-here",
    "model": "deepseek-reasoner"
  },
  "prompts": {
    "image_recognition": "请分析这张图片中的菜品...",
    "markdown_optimize": "请优化以下Markdown文档...",
    "subtitle_recipe_extraction": "请从以下视频字幕中提取菜谱内容...",
    
    "final_tutorial_generation": "你是一位专业的烹饪教学内容编辑。现在需要你整合多份资料，生成一份完整、详尽、易于理解的烹饪制作教程。\n\n你将收到以下资料：\n1. **视频字幕文本** - 原始的视频字幕内容\n2. **初步菜谱** - 从字幕中提取的基础菜谱\n3. **精细化分析** - 缺漏细节分析和完整性评估\n4. **视觉补充内容** - 基于视频关键帧的详细分析和时间标注\n\n你的任务是：\n\n## 📋 输出要求\n\n请生成一份结构完整的烹饪教程，包含以下部分：\n\n### 1. 菜品名称和简介\n- 菜品的正式名称\n- 简短的背景介绍（如果有）\n- 特点和风味描述\n\n### 2. 准备工作\n#### 2.1 食材清单\n- 主料（包含精确的用量和规格）\n- 辅料和调味料（包含精确的比例）\n- 特殊说明（如食材的选择标准、替代方案）\n\n#### 2.2 工具准备\n- 所需的厨具和器具\n- 温度计、计量工具等辅助工具\n\n### 3. 详细制作步骤\n将制作过程分解为清晰的步骤，每个步骤需包含：\n- **步骤编号和标题**\n- **具体操作** - 详细的操作说明\n- **关键参数** - 温度、时间、火候等\n- **视觉标准** - 描述应该看到的状态（颜色、质地、形态等）\n- **技巧提示** - 操作的注意事项和技巧\n- **参考时间点** - 标注视频中的时间（格式：MM:SS 或 HH:MM:SS）\n\n### 4. 烹饪原理与技巧\n- 关键操作背后的科学原理（如为什么要这样做）\n- 重要的烹饪技巧总结\n- 常见问题和解决方案\n\n### 5. 成品标准\n- 完成品的外观描述\n- 口感和味道特征\n- 保存和食用建议\n\n### 6. 难度评估和时间预估\n- 难度等级（简单/中等/困难）\n- 准备时间\n- 制作时间\n- 总计用时\n\n## ✍️ 写作要求\n\n1. **精确性** - 所有温度、时间、用量必须明确，不使用\"适量\"、\"少许\"等模糊词汇\n2. **完整性** - 整合所有资料中的信息，不遗漏任何重要细节\n3. **结构化** - 使用清晰的 Markdown 格式，层次分明\n4. **可操作性** - 即使完全没有看过视频，读者也能按照教程成功制作\n5. **专业性** - 使用准确的烹饪术语，解释关键原理\n6. **易读性** - 语言简洁明了，适当使用emoji增强可读性\n\n## 📦 资料内容\n\n{materials}\n\n---\n\n请基于以上资料，生成完整的烹饪制作教程。"
  },
  "fine_grained_processor": {
    "prompt_template": "这是来自于一个烹饪教学视频的字幕..."
  }
}
```

## 完整的 config.json 示例

为了方便，这里提供一个完整的配置文件示例：

```json
{
  "api_provider": "deepseek",
  "ollama": {
    "base_url": "http://localhost:11434",
    "model": "qwen3-vl:32b"
  },
  "deepseek": {
    "base_url": "https://api.deepseek.com/v1",
    "api_key": "sk-3b6b1291cd874cada91e90dccd34440b",
    "model": "deepseek-reasoner"
  },
  "prompts": {
    "image_recognition": "请分析这张图片中的菜品，用Markdown格式输出一份易读的菜谱。\n\n要求：\n- 保留所有的烹饪细节、材料比例、温度、时间等信息\n- 使用便于教学的清晰排版格式\n- 可以自由调整结构，只要易于阅读即可\n- 保持中文输出\n\n输出为Markdown格式即可。",
    
    "markdown_optimize": "请优化以下Markdown文档，使其成为易于阅读的菜谱。\n\n要求：\n- 完整保留所有烹饪细节、配料比例、温度、时间、技巧等信息，一个都不能少\n- 调整排版格式使其易于教学和查阅\n- 保持Markdown格式，自由调整结构即可\n- 强调清晰易读，方便按步骤操作\n\n原文档：\n{content}\n\n请输出调整后的Markdown文档：",
    
    "subtitle_recipe_extraction": "请从以下视频字幕中提取菜谱内容，用Markdown格式组织。\n\n要求：\n- 完整保留所有烹饪细节、材料比例、温度、时间等信息\n- 使用便于教学的清晰排版格式\n- 组织为：菜名、材料清单、烹饪步骤、烹饪技巧等结构，如果某项操作对应某种原理，一定要完整记录\n- 如果字幕中没有完整的菜谱信息，请提出缺漏的部分，用于后续需要图像识别的提示词\n- 保持中文输出，易于阅读和操作\n\n字幕内容如下：\n{content}\n\n请输出提取后的Markdown格式菜谱：",
    
    "final_tutorial_generation": "你是一位专业的烹饪教学内容编辑。现在需要你整合多份资料，生成一份完整、详尽、易于理解的烹饪制作教程。\n\n你将收到以下资料：\n1. **视频字幕文本** - 原始的视频字幕内容\n2. **初步菜谱** - 从字幕中提取的基础菜谱\n3. **精细化分析** - 缺漏细节分析和完整性评估\n4. **视觉补充内容** - 基于视频关键帧的详细分析和时间标注\n\n你的任务是：\n\n## 📋 输出要求\n\n请生成一份结构完整的烹饪教程，包含以下部分：\n\n### 1. 菜品名称和简介\n- 菜品的正式名称\n- 简短的背景介绍（如果有）\n- 特点和风味描述\n\n### 2. 准备工作\n#### 2.1 食材清单\n- 主料（包含精确的用量和规格）\n- 辅料和调味料（包含精确的比例）\n- 特殊说明（如食材的选择标准、替代方案）\n\n#### 2.2 工具准备\n- 所需的厨具和器具\n- 温度计、计量工具等辅助工具\n\n### 3. 详细制作步骤\n将制作过程分解为清晰的步骤，每个步骤需包含：\n- **步骤编号和标题**\n- **具体操作** - 详细的操作说明\n- **关键参数** - 温度、时间、火候等\n- **视觉标准** - 描述应该看到的状态（颜色、质地、形态等）\n- **技巧提示** - 操作的注意事项和技巧\n- **参考时间点** - 标注视频中的时间（格式：MM:SS 或 HH:MM:SS）\n\n### 4. 烹饪原理与技巧\n- 关键操作背后的科学原理（如为什么要这样做）\n- 重要的烹饪技巧总结\n- 常见问题和解决方案\n\n### 5. 成品标准\n- 完成品的外观描述\n- 口感和味道特征\n- 保存和食用建议\n\n### 6. 难度评估和时间预估\n- 难度等级（简单/中等/困难）\n- 准备时间\n- 制作时间\n- 总计用时\n\n## ✍️ 写作要求\n\n1. **精确性** - 所有温度、时间、用量必须明确，不使用\"适量\"、\"少许\"等模糊词汇\n2. **完整性** - 整合所有资料中的信息，不遗漏任何重要细节\n3. **结构化** - 使用清晰的 Markdown 格式，层次分明\n4. **可操作性** - 即使完全没有看过视频，读者也能按照教程成功制作\n5. **专业性** - 使用准确的烹饪术语，解释关键原理\n6. **易读性** - 语言简洁明了，适当使用emoji增强可读性\n\n## 📦 资料内容\n\n{materials}\n\n---\n\n请基于以上资料，生成完整的烹饪制作教程。"
  },
  "fine_grained_processor": {
    "prompt_template": "这是来自于一个烹饪教学视频的字幕，和从中提炼出的菜谱内容。请你比对两者，从1-10先给纯字幕内容是否能够完整表达教学内容打一个分。仅靠字幕就能完整复现的打10分，仅靠字幕内容无法指导任何制作的打1分。\n\n然后，请指出字幕中缺漏的关键烹饪细节，并生成一份【视频截图时间表】，用于后续的图像识别补充。\n\n【严格输出格式要求】\n\n## 完整性评分\nCOMPLETENESS_SCORE: [0-10之间的整数]\nCOMPLETENESS_REASON: [简要说明，单行]\n\n## 缺漏内容分析\n\n### 缺漏细节清单\nMISSING_DETAILS:\n- 细节1：[具体缺漏内容]\n- 细节2：[具体缺漏内容]\n- ...\n\n## 视频截图时间表\nFRAME_EXTRACTION_TABLE:\n\n| 序号 | 时间戳 | 截图用途 | 缺漏细节 | 优先级 |\n|-----|-------|---------|--------|--------|\n| 1 | 00:mm:ss | [截图在视频中要识别的主要对象] | [这个截图要补充什么信息] | HIGH/MEDIUM/LOW |\n| 2 | 00:mm:ss | ... | ... | ... |\n\n**时间戳说明**：从字幕中推测的视频画面时间点（格式：HH:MM:SS）\n**截图用途**：明确指出这一帧应该识别什么（如\"材料堆积状态\"、\"蛋液流动性\"、\"锅内气泡情况\"等）\n**缺漏细节**：说明这一截图要补充的烹饪细节\n**优先级**：HIGH/MEDIUM/LOW，标记关键程度\n\nTABLE_END\n\n字幕内容：\n{subtitle_content}\n\n提炼出的菜谱内容：\n{recipe_content}\n\n请严格按照格式输出，确保每一行格式一致：\n"
  }
}
```

## 使用说明

1. 将上述完整内容复制到你的 `config.json` 文件中
2. 根据需要修改 `final_tutorial_generation` 提示词
3. 保存后运行 `final_tutorial_generator.py` 或在 `main_pipeline.py` 中调用阶段四

## 提示词设计要点

这个提示词设计考虑了：

### ✅ 结构完整性
- 从菜品介绍到成品标准，涵盖完整流程
- 包含原理讲解和技巧总结

### ✅ 精确性要求
- 明确要求所有参数（温度、时间、用量）必须具体
- 避免模糊词汇

### ✅ 可操作性
- 强调即使不看视频也能复现
- 要求视觉标准描述

### ✅ 专业性
- 要求解释烹饪原理
- 使用准确术语

### ✅ 易读性
- Markdown 格式
- 层次分明
- 支持 emoji

## 自定义建议

你可以根据需求调整：

1. **简化版本**：删除"烹饪原理与技巧"部分
2. **营养版本**：添加"营养成分分析"部分
3. **视频版本**：强化"参考时间点"的要求
4. **图文版本**：要求在关键步骤位置标注需要配图的位置

修改时直接编辑 config.json 中的 `"final_tutorial_generation"` 字段即可。
